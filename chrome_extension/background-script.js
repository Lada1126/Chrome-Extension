
// Parse the stringified browser fingerprint.
// This value is filled in from Python as a template variable.
const browserFingerprint = JSON.parse("{\"server_useragent\": \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"server_useragent_info\": \"Chrome 84.0 Blink (browser)\", \"server_useragent_os\": \"Windows 10 x64\", \"server_useragent_device\": \"desktop\", \"server_useragent_brand\": \"\", \"server_useragent_model\": \"\", \"server_ip\": \"204.58.233.6\", \"server_country\": \"United States\", \"server_city\": \"Omaha\", \"server_region\": \"Nebraska\", \"server_isp\": \"First National Bank of Omaha\", \"server_asn\": \"14888\", \"server_lat\": 41.3333, \"server_long\": -96.0458, \"javascript_enabled\": \"true\", \"screen_width\": 1920, \"screen_height\": 1080, \"innerWidth\": 2064, \"innerHeight\": 1085, \"navigator_userAgent\": \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"navigator_appVersion\": \"5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36\", \"navigator_appName\": \"Netscape\", \"navigator_appCodeName\": \"Mozilla\", \"navigator_product\": \"Gecko\", \"navigator_productSub\": \"20030107\", \"navigator_vendor\": \"Google Inc.\", \"navigator_vendorSub\": null, \"navigator_buildID\": null, \"navigator_platform\": \"Win32\", \"navigator_oscpu\": null, \"navigator_hardwareConcurrency\": 4, \"navigator_language\": \"en-US\", \"navigator_languages\": \"[\\\"en-US\\\",\\\"en\\\"]\", \"navigator_onLine\": \"true\", \"navigator_doNotTrack\": null, \"navigator_cookieEnabled\": \"true\", \"navigator_maxTouchPoints\": 5, \"navigator_activeVRDisplays\": null, \"battery_charging\": \"true\", \"battery_chargingTime\": \"0\", \"battery_dischargingTime\": null, \"battery_level\": 1.0, \"audio_state\": \"suspended\", \"audio_sampleRate\": 44100, \"audio_maxChannelCount\": 2, \"audio_numberOfInputs\": 1, \"audio_numberOfOutputs\": 0, \"audio_channelCount\": 2, \"audio_channelCountMode\": \"explicit\", \"audio_channelInterpretation\": \"speakers\", \"audio_fftSize\": 2048, \"audio_frequencyBinCount\": 1024, \"audio_minDecibels\": -100, \"audio_maxDecibels\": -30, \"audio_smoothingTimeConstant\": 0.8, \"permission_geolocation\": \"prompt\", \"permission_notifications\": \"prompt\", \"permission_midi\": \"granted\", \"permission_midiSysEx\": \"prompt\", \"permission_push\": \"prompt\", \"navigator_javaEnabled\": \"false\", \"navigator_getGamepads\": \"[]\", \"navigator_getVRDisplays\": \"[]\", \"navigator_taintEnabled\": null, \"navigator_mimeTypes\": \"[{\\\"description\\\":\\\"\\\",\\\"suffixes\\\":\\\"pdf\\\",\\\"type\\\":\\\"application\\\\/pdf\\\",\\\"enabledPlugin\\\":{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"mhjfbmdgcfjbbpaeojofohoefgiehjai\\\",\\\"length\\\":1,\\\"name\\\":\\\"Chrome PDF Viewer\\\"}},{\\\"description\\\":\\\"Portable Document Format\\\",\\\"suffixes\\\":\\\"pdf\\\",\\\"type\\\":\\\"application\\\\/x-google-chrome-pdf\\\",\\\"enabledPlugin\\\":{\\\"description\\\":\\\"Portable Document Format\\\",\\\"filename\\\":\\\"internal-pdf-viewer\\\",\\\"length\\\":1,\\\"name\\\":\\\"Chrome PDF Plugin\\\"}},{\\\"description\\\":\\\"Native Client Executable\\\",\\\"suffixes\\\":\\\"\\\",\\\"type\\\":\\\"application\\\\/x-nacl\\\",\\\"enabledPlugin\\\":{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"internal-nacl-plugin\\\",\\\"length\\\":2,\\\"name\\\":\\\"Native Client\\\"}},{\\\"description\\\":\\\"Portable Native Client Executable\\\",\\\"suffixes\\\":\\\"\\\",\\\"type\\\":\\\"application\\\\/x-pnacl\\\",\\\"enabledPlugin\\\":{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"internal-nacl-plugin\\\",\\\"length\\\":2,\\\"name\\\":\\\"Native Client\\\"}}]\", \"navigator_plugins\": \"[{\\\"description\\\":\\\"Portable Document Format\\\",\\\"filename\\\":\\\"internal-pdf-viewer\\\",\\\"length\\\":1,\\\"name\\\":\\\"Chrome PDF Plugin\\\",\\\"mimeTypes\\\":[{\\\"description\\\":\\\"Portable Document Format\\\",\\\"suffixes\\\":\\\"pdf\\\",\\\"type\\\":\\\"application\\\\/x-google-chrome-pdf\\\"}]},{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"mhjfbmdgcfjbbpaeojofohoefgiehjai\\\",\\\"length\\\":1,\\\"name\\\":\\\"Chrome PDF Viewer\\\",\\\"mimeTypes\\\":[{\\\"description\\\":\\\"\\\",\\\"suffixes\\\":\\\"pdf\\\",\\\"type\\\":\\\"application\\\\/pdf\\\"}]},{\\\"description\\\":\\\"\\\",\\\"filename\\\":\\\"internal-nacl-plugin\\\",\\\"length\\\":2,\\\"name\\\":\\\"Native Client\\\",\\\"mimeTypes\\\":[{\\\"description\\\":\\\"Native Client Executable\\\",\\\"suffixes\\\":\\\"\\\",\\\"type\\\":\\\"application\\\\/x-nacl\\\"},{\\\"description\\\":\\\"Portable Native Client Executable\\\",\\\"suffixes\\\":\\\"\\\",\\\"type\\\":\\\"application\\\\/x-pnacl\\\"}]}]\", \"navigator_mediaDevices\": \"[]\", \"navigator_credentials\": null, \"navigator_webdriver\": null, \"navigator_storage_enabled\": \"true\", \"navigator_storage_estimate\": \"[]\", \"navigator_storage_persist\": \"false\", \"navigator_storage_persisted\": \"false\", \"geolocation_latitude\": null, \"geolocation_longitude\": null, \"geolocation_accuracy\": null, \"geolocation_cacheAge\": null, \"webgl_webGLSupport\": \"true\", \"webgl_webGL2Support\": \"true\", \"webgl_supportedContextNames\": \"[\\\"webgl2\\\",\\\"webgl\\\",\\\"experimental-webgl\\\"]\", \"webgl_version\": \"WebGL 2.0 (OpenGL ES 3.0 Chromium)\", \"webgl_shadingLanguageVersion\": \"WebGL GLSL ES 3.00 (OpenGL ES GLSL ES 3.0 Chromium)\", \"webgl_vendor\": \"WebKit\", \"webgl_renderer\": \"WebKit WebGL\", \"webgl_antialiasing\": \"true\", \"webgl_ANGLE\": \"false\", \"webgl_majorPerformanceCaveat\": \"false\", \"webgl_unmaskedVendor\": \"Google Inc.\", \"webgl_unmaskedRenderer\": \"Google SwiftShader\", \"webrtc_RTCPeerConnection\": \"true\", \"webrtc_RTCDataChannel\": \"true\", \"webrtc_ORTC\": \"false\", \"webrtc_deviceEnumeration\": null, \"webrtc_hasMicrophone\": null, \"webrtc_hasCamera\": null, \"webrtc_mediaDevices\": \"[{\\\"deviceId\\\":null,\\\"groupId\\\":\\\"69a19f0ad1a80cd7763d4b47b0d1fde3a0fabcb10a551bcaac666877eba882c4\\\",\\\"kind\\\":\\\"audioinput\\\",\\\"label\\\":null},{\\\"deviceId\\\":null,\\\"groupId\\\":\\\"688b0d5c2e1faf16874b4172c4e51fc5108e4756f7ed7fefb93c74605bef7775\\\",\\\"kind\\\":\\\"videoinput\\\",\\\"label\\\":null},{\\\"deviceId\\\":null,\\\"groupId\\\":\\\"69a19f0ad1a80cd7763d4b47b0d1fde3a0fabcb10a551bcaac666877eba882c4\\\",\\\"kind\\\":\\\"audiooutput\\\",\\\"label\\\":null}]\", \"webrtc_localIP\": \"127.0.0.2\", \"webrtc_publicIP\": \"127.0.0.1\", \"canvas_supported\": \"true\", \"canvas_textAPI\": \"true\", \"canvas_toDataURL\": \"true\", \"gyroscope_supported\": \"true\", \"gyroscope_isMoving\": \"true\", \"gyroscope_x\": null, \"gyroscope_y\": null, \"gyroscope_z\": null, \"gyroscope_xWithGravity\": null, \"gyroscope_yWithGravity\": null, \"gyroscope_zWithGravity\": null, \"gyroscope_rotationAlpha\": null, \"gyroscope_rotationBeta\": null, \"gyroscope_rotationGamma\": null, \"gyroscope_interval\": 16.0, \"connection\": \"{\\\"effectiveType\\\":\\\"4g\\\",\\\"rtt\\\":100,\\\"downlink\\\":10,\\\"saveData\\\":false}\", \"connection_type\": null, \"connection_effectiveType\": \"4g\", \"connection_downlink\": 10.0, \"connection_downlinkMax\": null, \"connection_rtt\": 100, \"connection_saveData\": \"false\", \"fonts\": \"[\\\"Arial\\\",\\\"Arial Black\\\",\\\"Arial Narrow\\\",\\\"Arial Unicode MS\\\",\\\"Book Antiqua\\\",\\\"Bookman Old Style\\\",\\\"Calibri\\\",\\\"Cambria\\\",\\\"Cambria Math\\\",\\\"Century\\\",\\\"Century Gothic\\\",\\\"Century Schoolbook\\\",\\\"Comic Sans MS\\\",\\\"Consolas\\\",\\\"Courier\\\",\\\"Courier New\\\",\\\"Georgia\\\",\\\"Helvetica\\\",\\\"Impact\\\",\\\"Lucida Bright\\\",\\\"Lucida Calligraphy\\\",\\\"Lucida Console\\\",\\\"Lucida Fax\\\",\\\"Lucida Handwriting\\\",\\\"Lucida Sans\\\",\\\"Lucida Sans Typewriter\\\",\\\"Lucida Sans Unicode\\\",\\\"Microsoft Sans Serif\\\",\\\"Monotype Corsiva\\\",\\\"MS Gothic\\\",\\\"MS PGothic\\\",\\\"MS Reference Sans Serif\\\",\\\"MS Sans Serif\\\",\\\"MS Serif\\\",\\\"Palatino Linotype\\\",\\\"Segoe Print\\\",\\\"Segoe Script\\\",\\\"Segoe UI\\\",\\\"Segoe UI Light\\\",\\\"Segoe UI Semibold\\\",\\\"Segoe UI Symbol\\\",\\\"Tahoma\\\",\\\"Times\\\",\\\"Times New Roman\\\",\\\"Trebuchet MS\\\",\\\"Verdana\\\",\\\"Wingdings\\\",\\\"Wingdings 2\\\",\\\"Wingdings 3\\\",\\\"Agency FB\\\",\\\"Algerian\\\",\\\"Baskerville Old Face\\\",\\\"Bauhaus 93\\\",\\\"Bell MT\\\",\\\"Berlin Sans FB\\\",\\\"Bernard MT Condensed\\\",\\\"Blackadder ITC\\\",\\\"Bodoni MT\\\",\\\"Bodoni MT Black\\\",\\\"Bodoni MT Condensed\\\",\\\"Bookshelf Symbol 7\\\",\\\"Bradley Hand ITC\\\",\\\"Broadway\\\",\\\"Brush Script MT\\\",\\\"Californian FB\\\",\\\"Calisto MT\\\",\\\"Candara\\\",\\\"Castellar\\\",\\\"Centaur\\\",\\\"Chiller\\\",\\\"Colonna MT\\\",\\\"Constantia\\\",\\\"Cooper Black\\\",\\\"Copperplate Gothic\\\",\\\"Copperplate Gothic Light\\\",\\\"Corbel\\\",\\\"Curlz MT\\\",\\\"Ebrima\\\",\\\"Edwardian Script ITC\\\",\\\"Elephant\\\",\\\"Engravers MT\\\",\\\"Felix Titling\\\",\\\"Footlight MT Light\\\",\\\"Forte\\\",\\\"Freestyle Script\\\",\\\"French Script MT\\\",\\\"Gabriola\\\",\\\"Gigi\\\",\\\"Gill Sans MT\\\",\\\"Gill Sans MT Condensed\\\",\\\"Goudy Old Style\\\",\\\"Goudy Stout\\\",\\\"Haettenschweiler\\\",\\\"Harrington\\\",\\\"High Tower Text\\\",\\\"Imprint MT Shadow\\\",\\\"Informal Roman\\\",\\\"Jokerman\\\",\\\"Juice ITC\\\",\\\"Kristen ITC\\\",\\\"Kunstler Script\\\",\\\"Leelawadee\\\",\\\"Magneto\\\",\\\"Maiandra GD\\\",\\\"Malgun Gothic\\\",\\\"Marlett\\\",\\\"Matura MT Script Capitals\\\",\\\"Microsoft Himalaya\\\",\\\"Microsoft JhengHei\\\",\\\"Microsoft New Tai Lue\\\",\\\"Microsoft PhagsPa\\\",\\\"Microsoft Tai Le\\\",\\\"Microsoft Uighur\\\",\\\"Microsoft YaHei\\\",\\\"Microsoft Yi Baiti\\\",\\\"MingLiU_HKSCS-ExtB\\\",\\\"MingLiU-ExtB\\\",\\\"Mistral\\\",\\\"Modern No. 20\\\",\\\"Mongolian Baiti\\\",\\\"MS Reference Specialty\\\",\\\"MS UI Gothic\\\",\\\"MT Extra\\\",\\\"MV Boli\\\",\\\"Niagara Engraved\\\",\\\"Niagara Solid\\\",\\\"NSimSun\\\",\\\"Old English Text MT\\\",\\\"Onyx\\\",\\\"Palace Script MT\\\",\\\"Papyrus\\\",\\\"Parchment\\\",\\\"Perpetua\\\",\\\"Perpetua Titling MT\\\",\\\"Playbill\\\",\\\"PMingLiU-ExtB\\\",\\\"Poor Richard\\\",\\\"Pristina\\\",\\\"Ravie\\\",\\\"Rockwell\\\",\\\"Rockwell Condensed\\\",\\\"Showcard Gothic\\\",\\\"SimSun\\\",\\\"SimSun-ExtB\\\",\\\"Snap ITC\\\",\\\"Stencil\\\",\\\"Sylfaen\\\",\\\"Tempus Sans ITC\\\",\\\"Tw Cen MT\\\",\\\"Tw Cen MT Condensed\\\",\\\"Viner Hand ITC\\\",\\\"Vivaldi\\\",\\\"Vladimir Script\\\",\\\"Wide Latin\\\"]\"}");

// Extract the user agent string.
const userAgent = browserFingerprint.server_useragent || browserFingerprint.userAgent;

// Define a function for mutating the request headers.
const replaceUserAgentHeader = ({ requestHeaders }) => {
  requestHeaders
    .filter(header => /user-agent/i.test(header.name))
    .forEach(header => header.value = userAgent);
  return { requestHeaders };
};

// Intercept all web requests and mutate the headers to have the correct user agent.
(chrome || browser).webRequest.onBeforeSendHeaders.addListener(
  replaceUserAgentHeader,
  { urls: ['<all_urls>'], },
  ['blocking', 'requestHeaders']
);
